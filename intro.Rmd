---
output:
  pdf_document: default
  html_document: default
---

Este proyecto nace como un instrumento para poder aplicar los contenidos aprendidos durante el semestre en un problema real. Se tendrá que demostrar los conocimentos adquiridos al realizar un analisis exploratorio sobre datos de interes nacional, poniendo especial énfasis en la correcta visualización de los resultados obtenidos, realizando una correcta interpretación de la misma. 
En el caso de este grupo en cuestión, se analizarán datos de incautaciones de aduana presentados por la Dirección Nacional de Aduanas, que fueron elegidos  Para llevar a cabo estos objetivos, se utilizará exclusivamente el lenguaje de programación R, y sus respectivas expansiones, como Markdown, Shiny y RStudio.


```{r,echo=FALSE}

library(tidyverse)

datos <- read_csv2('datos.csv')

dim(datos)

```

Los datos  fueron obtenidos en el catalogo de datos abiertos que puso a disposición el gobierno uruguayo. Más específicamente estos fueron subidos por la Dirección Nacional de Aduanas. Cuentan con 16 variables y 76.792 observaciones. Tres de las varibles son de tipo double, mientras que las restantes son de tipo caracter.   

```{r,echo=FALSE}

datos <- datos %>%
  
            rename(fecha_incautacion = TIEM_DIA_SK_INCAUTACION ,
                   aduana = ADUA_ADUA_DESCC , 
                   infraccion = INFR_INFR_DESCC ,
                   pais_procedencia = PAIS_PAIS_DESCC_PAIS_PROCEDENC ,
                   unidad = UCOM_UCOM_DESCC ,
                   estado_incautacion = ESTINC_ESTINC_DESCC ,
                   tipo = TINC_TINC_DESCC ,
                   cantidad = INC_CANTIDAD ,
                   valor = INC_VALOR_MN) %>%
  
            select(fecha_incautacion,
                   aduana,
                   infraccion,
                   pais_procedencia,
                   unidad,
                   estado_incautacion,
                   tipo,
                   cantidad,
                   valor) 

glimpse(datos)

```

```{r,echo=FALSE}

#cambiar tildes y ñ

lapply(datos, gsub, pattern = "Á", replacement = "A")
lapply(datos, gsub, pattern = "É", replacement = "E")
lapply(datos, gsub, pattern = "Í", replacement = "I")
lapply(datos, gsub, pattern = "Ó", replacement = "O")
lapply(datos, gsub, pattern = "Ú", replacement = "U")
lapply(datos, gsub, pattern = "Ñ", replacement = "N")

library(data.table)

datos <- as.data.table(datos)
datos <- datos[, lapply(.SD, iconv, "latin1", "UTF-8")]

```

Para realizar la exploración, nos planteamos algunas preguntas para orientar el análisis. En primer lugar, decidimos investigar de qué manera había evolucionado la cantidad total de incautaciones durante el período en cuestión, teniendo en cuenta las diferentes infracciones que se pueden realizar.

```{r,echo=FALSE,fig.cap=}
datos %>% mutate(fecha=ym(TIEM_DIA_SK_INCAUTACION)) %>% group_by(fecha) %>% summarise(conteo=n()) %>% ggplot(aes(x=fecha,y=conteo))+geom_line()+stat_peaks()+stat_peaks(geom="text",color="black",vjust=-0.3)
```
```{r,echo=FALSE,fig.cap=}
datos %>% separate(TIEM_DIA_SK_INCAUTACION, into=c("anio","mes"),sep=4) %>%group_by(INFR_INFR_DESCC,anio) %>% summarise(conteo=n()) %>% ggplot(aes(x=anio,y=conteo))+geom_col()+facet_wrap(~INFR_INFR_DESCC,scales="free")
```

Luego decidimos analizar más en profundidad la variable "Valor", que indica el valor de la incautación realizada en cada caso. Para hacer esto, iniciamos observando la distribución de la variable, para luego adentrarnos en la relación que tiene el valor con la cantidad de incautaciones incautadas.

```{r,echo=FALSE,fig.cap=}
datos %>% filter(as.numeric(INC_VALOR_MN)<atipicovalor) %>%ggplot(aes(x=as.numeric(INC_VALOR_MN)))+geom_histogram()
```
```{r,echo=FALSE,fig.cap=}
atipicovalor<-quantile(as.numeric(datos$INC_VALOR_MN),probs=0.75)+1.5*(quantile(as.numeric(datos$INC_VALOR_MN),probs=0.75)-quantile(as.numeric(datos$INC_VALOR_MN),probs=0.25))

atipicocantidad<-quantile(as.numeric(datos$INC_CANTIDAD),probs=0.75)+1.5*(quantile(as.numeric(datos$INC_CANTIDAD),probs=0.75)-quantile(as.numeric(datos$INC_CANTIDAD),probs=0.25))

datos %>% mutate(INC_CANTIDAD=round(as.numeric(INC_CANTIDAD),0),INC_VALOR_MN=round(as.numeric(INC_VALOR_MN),0))%>% filter(INC_VALOR_MN<atipicovalor)%>% filter(INC_CANTIDAD<atipicocantidad)%>% ggplot(aes(x=INC_VALOR_MN,y=INC_CANTIDAD))+geom_point(alpha=1/5)+theme(aspect.ratio = 1)
```
```{r,echo=FALSE,fig.cap=}
cor(as.numeric(datos$INC_CANTIDAD),as.numeric(datos$INC_VALOR_MN))
```

A continuación nos enfocamos en la variable "aduana", que hace referncia al lugar dentro del Uruguay que se realizó el acto de incautar. Como primer paso se investigó de que manera se distribuyen las incautaciones totales dentro del territorio nacional. Sucesivamente, nos interesó saber el destino de cada uno de estos actos, sabiendo también el origen.

```{r,echo=FALSE,fig.cap=}
datos%>%group_by(ADUA_ADUA_DESCC) %>% summarise(conteo=n()) %>% ggplot(aes(x=fct_reorder(ADUA_ADUA_DESCC,conteo),y=conteo))+geom_col()+theme(axis.text.x = element_text(angle = 90, vjust=0.5, size = 8))
```
```{r,echo=FALSE,fig.cap=}
tabla2 <- subset(data.frame( table(datos$ADUA_ADUA_DESCC)))
aduanas <- subset(datos, ADUA_ADUA_DESCC %in% tabla2$Var1)
tabla2<- data.frame( with(aduanas, table(PAIS_PAIS_DESCC_PAIS_PROCEDENC, ADUA_ADUA_DESCC) ) )
ggplot(tabla2) + geom_tile(aes(x=PAIS_PAIS_DESCC_PAIS_PROCEDENC, y=ADUA_ADUA_DESCC, fill=Freq))+ theme(axis.text.x = element_text(angle = 90, vjust=0.5, size = 8))+scale_fill_gradient(low="white",high="black")
```

Como último objetivo, decidimos investigar el estado en el que se encuantra cada incautación, intentando observar cuál infracción demora más tiempo en resolverse.
```{r,echo=FALSE,fig.cap=}
datos %>% group_by(INFR_INFR_DESCC,ESTINC_ESTINC_DESCC) %>% summarise(conteo=n())
tabla<-data.frame(estado=c("Contencioso Final","Contencioso Inicial","Falsificacion","Ingresado","Valorador","Contencioso Final","Contencioso Inicial","Falsificacion","Ingresado","Valorador","Contencioso Final","Contencioso Inicial","Falsificacion","Ingresado","Valorador","Contencioso Final","Contencioso Inicial","Falsificacion","Ingresado","Valorador"),infraccion=c("Abandono","Abandono","Abandono","Abandono","Abandono","Contrabando","Contrabando","Contrabando","Contrabando","Contrabando","Falsificacion","Falsificacion","Falsificacion","Falsificacion","Falsificacion","Receptacion","Receptacion","Receptacion","Receptacion","Receptacion"),Freq=c(17362,399,365,438,2,54169,2090,1004,416,314,101,0,3,0,0,129,0,0,0,0))
ggplot(tabla,aes(x=estado,y=infraccion,fill=Freq))+geom_tile()+scale_fill_gradient(low="white",high="blue")+geom_text(aes(label=Freq))
```

Shiny


Conlusiones finales